<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SaltSync Report Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DESIGN SYSTEM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root{
  --P:#5c35e8;--P2:#7b5cf0;--P3:#a98ef7;
  --T:#00b89c;--T2:#00d4b4;
  --G:#22c55e;--R:#ef4444;--Y:#f59e0b;
  --ink:#0f0e17;--ink2:#2d2b45;--ink3:#6b6a82;
  --bg:#f7f6ff;--bg2:#eeecfd;--bg3:#e4e1fc;
  --card:#ffffff;--border:#dddaf7;
  --sh:0 2px 16px rgba(92,53,232,.10);
  --sh2:0 6px 32px rgba(92,53,232,.18);
  --tr:.2s cubic-bezier(.4,0,.2,1);
  --r:12px;--r2:18px;--r3:26px;
}
[data-dark]{
  --ink:#f0eeff;--ink2:#c8c4f0;--ink3:#8886aa;
  --bg:#0d0c1a;--bg2:#13122a;--bg3:#1b193a;
  --card:#181630;--border:#2a2848;
  --sh:0 2px 16px rgba(0,0,0,.4);--sh2:0 6px 32px rgba(0,0,0,.5);
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--ink);min-height:100vh;transition:background var(--tr),color var(--tr)}
h1,h2,h3,h4,h5,h6{font-family:'Syne',sans-serif}
input,select,textarea,button{font-family:'DM Sans',sans-serif}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-thumb{background:var(--P3);border-radius:99px}

/* ‚îÄ‚îÄ BOOT ‚îÄ‚îÄ */
#boot{position:fixed;inset:0;z-index:9999;background:var(--ink);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .5s}
.boot-brand{font-family:'Syne',sans-serif;font-size:2.2rem;font-weight:800;color:#fff;letter-spacing:-1px}
.boot-brand b{color:var(--P3)}
.boot-track{width:200px;height:3px;background:rgba(255,255,255,.1);border-radius:99px;overflow:hidden;margin:1.2rem 0 .8rem}
.boot-bar{height:100%;background:linear-gradient(90deg,var(--P),var(--T));border-radius:99px;animation:bfill 1.6s ease forwards}
@keyframes bfill{from{width:0}to{width:100%}}
.boot-status{color:rgba(255,255,255,.45);font-size:.82rem}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
nav{position:fixed;top:0;inset-x:0;height:58px;background:var(--card);border-bottom:1.5px solid var(--border);display:flex;align-items:center;padding:0 1.4rem;gap:.75rem;z-index:200;box-shadow:var(--sh)}
.brand{font-family:'Syne',sans-serif;font-weight:800;font-size:1.2rem;text-decoration:none;color:var(--ink);flex:1}
.brand b{color:var(--P)}
.status-pill{display:inline-flex;align-items:center;gap:.4rem;padding:.28rem .75rem;border-radius:99px;font-size:.75rem;font-weight:600;border:1.5px solid var(--border);color:var(--ink3);transition:var(--tr)}
.status-pill.ok{border-color:var(--G);color:var(--G);background:rgba(34,197,94,.08)}
.status-pill.err{border-color:var(--R);color:var(--R);background:rgba(239,68,68,.08)}
.status-dot{width:6px;height:6px;border-radius:50%;background:currentColor}
.pulse{animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.35}}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{display:inline-flex;align-items:center;gap:.45rem;padding:.55rem 1.15rem;border-radius:99px;font-size:.85rem;font-weight:600;cursor:pointer;border:none;transition:var(--tr);white-space:nowrap}
.btn:hover{transform:translateY(-1px)}
.btn-p{background:var(--P);color:#fff;box-shadow:0 4px 18px rgba(92,53,232,.3)}
.btn-p:hover{background:var(--P2);box-shadow:var(--sh2)}
.btn-t{background:var(--T);color:#fff;box-shadow:0 4px 18px rgba(0,184,156,.25)}
.btn-t:hover{background:var(--T2)}
.btn-g{background:var(--G);color:#fff}
.btn-g:hover{opacity:.9}
.btn-r{background:var(--R);color:#fff}
.btn-r:hover{opacity:.9}
.btn-y{background:var(--Y);color:#fff}
.btn-y:hover{opacity:.9}
.btn-ghost{background:transparent;border:1.5px solid var(--border);color:var(--ink)}
.btn-ghost:hover{border-color:var(--P);color:var(--P);background:rgba(92,53,232,.05)}
.btn-sm{padding:.35rem .8rem;font-size:.78rem}
.btn-full{width:100%;justify-content:center;padding:.8rem}

/* ‚îÄ‚îÄ NOTIF BANNER ‚îÄ‚îÄ */
#notifBar{margin-top:58px;padding:9px 1rem;background:linear-gradient(90deg,var(--P),var(--T));color:#fff;text-align:center;font-size:.83rem;font-weight:500;letter-spacing:.1px}

/* ‚îÄ‚îÄ PAGE SYSTEM ‚îÄ‚îÄ */
.page{display:none;min-height:calc(100vh - 100px);padding:1.5rem 1rem 5rem}
.page.on{display:block;animation:pin .35s ease}
.fcenter{display:flex;align-items:center;justify-content:center;min-height:calc(100vh - 100px)}
@keyframes pin{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.wrap{max-width:1080px;margin:0 auto}
.wrap-sm{max-width:480px;margin:0 auto}
.wrap-md{max-width:700px;margin:0 auto}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r2);padding:1.75rem;box-shadow:var(--sh);transition:box-shadow var(--tr)}
.card:hover{box-shadow:var(--sh2)}
.card-flat{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r2);padding:1.5rem}
.card-sm{padding:1.1rem 1.3rem;border-radius:var(--r)}

/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
.dash-hero{text-align:center;padding:2.5rem 1rem 2rem}
.dash-title{font-size:2.8rem;font-weight:800;letter-spacing:-2px;line-height:1.1;margin-bottom:.75rem}
.grad{background:linear-gradient(135deg,var(--P),var(--T));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.dash-sub{color:var(--ink3);font-size:1rem;margin-bottom:2.5rem}
.opt-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;max-width:580px;margin:0 auto}
.opt-card{background:var(--card);border:2px solid var(--border);border-radius:var(--r2);padding:2rem 1.5rem;cursor:pointer;transition:var(--tr);text-align:left;position:relative;overflow:hidden}
.opt-card::before{content:'';position:absolute;top:0;right:0;width:80px;height:80px;border-radius:50%;opacity:.06;transition:var(--tr)}
.opt-card.emp::before{background:var(--P)}
.opt-card.tl::before{background:var(--T)}
.opt-card:hover{transform:translateY(-6px);box-shadow:var(--sh2)}
.opt-card.emp:hover{border-color:var(--P)}
.opt-card.tl:hover{border-color:var(--T)}
.opt-ico{font-size:2.2rem;margin-bottom:.85rem}
.opt-card.emp .opt-ico{color:var(--P)}
.opt-card.tl .opt-ico{color:var(--T)}
.opt-name{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700;margin-bottom:.35rem}
.opt-desc{font-size:.83rem;color:var(--ink3);line-height:1.55}
.opt-go{display:inline-flex;align-items:center;gap:.3rem;margin-top:.9rem;font-size:.82rem;font-weight:700;color:var(--P)}
.opt-card.tl .opt-go{color:var(--T)}
.opt-go i{transition:transform var(--tr)}
.opt-card:hover .opt-go i{transform:translateX(4px)}

/* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.full{grid-column:1/-1}
.fld{display:flex;flex-direction:column;gap:.38rem}
.fld label{font-size:.82rem;font-weight:700;color:var(--ink2);letter-spacing:.2px}
.fld input,.fld select,.fld textarea{
  background:var(--bg);border:1.5px solid var(--border);border-radius:var(--r);
  padding:.65rem 1rem;font-size:.9rem;color:var(--ink);outline:none;
  transition:border-color var(--tr),box-shadow var(--tr);width:100%
}
.fld input:focus,.fld select:focus,.fld textarea:focus{
  border-color:var(--P);box-shadow:0 0 0 3px rgba(92,53,232,.12)
}
.fld textarea{resize:vertical;min-height:110px;line-height:1.65}
.fld select option{background:var(--bg2)}
.hint{font-size:.76rem;color:var(--ink3);margin-top:.25rem}

/* ‚îÄ‚îÄ SECTION BLOCKS ‚îÄ‚îÄ */
.sec{background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--r2);padding:1.4rem;margin-top:1rem}
.sec.tl-sec{border-left:3px solid var(--T)}
.sec.p-sec{border-left:3px solid var(--P)}
.sec-head{font-family:'Syne',sans-serif;font-size:.9rem;font-weight:700;display:flex;align-items:center;gap:.5rem;margin-bottom:.9rem}
.sec-ico{width:28px;height:28px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;font-size:.78rem;flex-shrink:0}
.p-ico{background:rgba(92,53,232,.12);color:var(--P)}
.t-ico{background:rgba(0,184,156,.12);color:var(--T)}
.number-inp{width:90px;background:var(--bg);border:1.5px solid var(--border);border-radius:var(--r);padding:.55rem .8rem;font-size:1.1rem;font-weight:700;color:var(--ink);outline:none;text-align:center;transition:border-color var(--tr)}
.number-inp:focus{border-color:var(--P)}
.inline-ta{background:var(--bg);border:1.5px solid var(--border);border-radius:var(--r);padding:.7rem .9rem;width:100%;color:var(--ink);outline:none;font-family:'DM Sans',sans-serif;font-size:.88rem;resize:vertical;min-height:90px;line-height:1.65;transition:border-color var(--tr)}
.inline-ta:focus{border-color:var(--P)}
.tl-sec .inline-ta:focus{border-color:var(--T)}

/* ‚îÄ‚îÄ REPORT OUTPUT ‚îÄ‚îÄ */
.out-wrap{display:none;margin-top:1.25rem;background:var(--ink);border-radius:var(--r2);overflow:hidden}
.out-wrap.show{display:block;animation:pin .4s ease}
.out-topbar{display:flex;align-items:center;justify-content:space-between;padding:.65rem 1rem;background:rgba(255,255,255,.06);border-bottom:1px solid rgba(255,255,255,.08)}
.out-dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:.3rem}
pre.out-pre{padding:1.5rem;font-family:'Courier New',monospace;font-size:.83rem;color:#b9f6e8;line-height:1.7;white-space:pre-wrap;max-height:480px;overflow-y:auto}

/* ‚îÄ‚îÄ STATS GRID ‚îÄ‚îÄ */
.stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:.85rem;margin-bottom:1.25rem}
.stat-box{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r2);padding:1.2rem;text-align:center;transition:var(--tr)}
.stat-box:hover{transform:translateY(-3px);box-shadow:var(--sh)}
.stat-num{font-family:'Syne',sans-serif;font-size:2rem;font-weight:800}
.stat-lbl{font-size:.75rem;color:var(--ink3);margin-top:.25rem;font-weight:500}
.num-p{color:var(--P)}.num-t{color:var(--T)}.num-g{color:var(--G)}.num-y{color:var(--Y)}

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tab-bar{display:flex;flex-wrap:wrap;gap:.4rem;margin-bottom:1.25rem;padding-bottom:.85rem;border-bottom:1.5px solid var(--border)}
.tab{padding:.45rem 1rem;border-radius:99px;font-size:.82rem;font-weight:700;cursor:pointer;border:1.5px solid var(--border);background:transparent;color:var(--ink3);transition:var(--tr)}
.tab.on{background:var(--P);color:#fff;border-color:var(--P);box-shadow:0 4px 14px rgba(92,53,232,.25)}
.tab:hover:not(.on){border-color:var(--P);color:var(--P)}
.tp{display:none}.tp.on{display:block;animation:pin .3s ease}

/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.tbl-card{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r2);overflow:hidden}
.tbl-search{padding:.85rem 1.1rem;border-bottom:1.5px solid var(--border);display:flex;align-items:center;gap:.7rem}
.tbl-search input{flex:1;background:var(--bg);border:1.5px solid var(--border);border-radius:99px;padding:.45rem 1rem;font-size:.85rem;color:var(--ink);outline:none;transition:var(--tr)}
.tbl-search input:focus{border-color:var(--P)}
table{width:100%;border-collapse:collapse}
th{background:var(--bg3);color:var(--ink3);font-size:.73rem;font-weight:700;text-transform:uppercase;letter-spacing:.4px;padding:.75rem 1rem;text-align:left;white-space:nowrap}
td{padding:.75rem 1rem;font-size:.85rem;border-bottom:1px solid var(--border)}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(92,53,232,.03)}

/* ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ */
.badge{display:inline-block;padding:.2rem .65rem;border-radius:99px;font-size:.72rem;font-weight:700}
.b-p{background:rgba(92,53,232,.12);color:var(--P)}
.b-t{background:rgba(0,184,156,.12);color:var(--T)}
.b-g{background:rgba(34,197,94,.12);color:var(--G)}
.b-y{background:rgba(245,158,11,.12);color:var(--Y)}
.b-r{background:rgba(239,68,68,.12);color:var(--R)}
.b-gray{background:var(--bg3);color:var(--ink3)}

/* ‚îÄ‚îÄ EMP MGMT ‚îÄ‚îÄ */
.emp-row{display:flex;align-items:center;justify-content:space-between;padding:.9rem 1.1rem;background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--r);margin-bottom:.5rem;transition:var(--tr)}
.emp-row:hover{border-color:var(--P3);transform:translateX(3px)}
.emp-nm{font-weight:600;font-size:.9rem}
.emp-id-lbl{font-size:.78rem;color:var(--ink3);margin-top:.1rem}

/* ‚îÄ‚îÄ OVERVIEW ‚îÄ‚îÄ */
.ov-row{display:flex;align-items:center;justify-content:space-between;padding:.75rem .9rem;border-radius:var(--r);margin-bottom:.45rem;border-left:3px solid var(--T);background:rgba(0,184,156,.05)}
.ov-row.hi{border-color:var(--Y);background:rgba(245,158,11,.05)}
.ov-row.crit{border-color:var(--R);background:rgba(239,68,68,.06)}
.ov-cnt{font-family:'Syne',sans-serif;font-weight:800;padding:.2rem .7rem;border-radius:99px;color:#fff;font-size:.85rem}
.ov-row .ov-cnt{background:var(--T)}
.ov-row.hi .ov-cnt{background:var(--Y)}
.ov-row.crit .ov-cnt{background:var(--R);animation:blink 1.5s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.5}}

/* ‚îÄ‚îÄ KW CHIPS ‚îÄ‚îÄ */
.chip{display:inline-block;background:rgba(0,184,156,.1);color:var(--T);padding:.18rem .55rem;border-radius:99px;font-size:.72rem;font-weight:600;margin:.15rem;border:1px solid rgba(0,184,156,.2)}

/* ‚îÄ‚îÄ PHYS SUMMARY ‚îÄ‚îÄ */
.phys-row{display:grid;grid-template-columns:repeat(4,1fr);gap:.6rem;margin-top:.85rem}
.phys-box{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r);padding:.9rem;text-align:center}
.phys-v{font-family:'Syne',sans-serif;font-size:1.6rem;font-weight:800}
.phys-l{font-size:.72rem;color:var(--ink3);margin-top:.15rem}

/* ‚îÄ‚îÄ PORTAL CARDS ‚îÄ‚îÄ */
.p-card{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r2);padding:1.4rem;margin-bottom:.75rem;transition:var(--tr)}
.p-card:hover{box-shadow:var(--sh);transform:translateY(-2px)}
.p-date{font-family:'Syne',sans-serif;font-weight:700;font-size:.95rem}

/* ‚îÄ‚îÄ ADMIN LOGIN ‚îÄ‚îÄ */
.lock-wrap{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;margin:0 auto 1.25rem;transition:var(--tr)}
.lock-wrap.locked{background:linear-gradient(135deg,var(--P),var(--P2));color:#fff;box-shadow:0 8px 30px rgba(92,53,232,.35)}
.lock-wrap.bad{background:linear-gradient(135deg,var(--R),#ff7070);color:#fff}
.lock-wrap.good{background:linear-gradient(135deg,var(--G),var(--T));color:#fff}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
.shake{animation:shake .4s ease}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter:blur(8px);z-index:400;display:none;align-items:center;justify-content:center;padding:1rem}
.modal-bg.on{display:flex;animation:pin .25s ease}
.modal{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r3);padding:2rem;width:100%;max-width:680px;max-height:90vh;overflow-y:auto;box-shadow:0 24px 80px rgba(0,0,0,.45);animation:mdin .3s ease;position:relative}
@keyframes mdin{from{transform:scale(.95) translateY(20px);opacity:0}to{transform:scale(1) translateY(0);opacity:1}}
.modal pre{background:var(--ink);color:#b9f6e8;padding:1.25rem;border-radius:var(--r);font-size:.8rem;line-height:1.7;white-space:pre-wrap;max-height:480px;overflow-y:auto;margin-top:1rem}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toasts{position:fixed;bottom:1.4rem;right:1.4rem;z-index:9999;display:flex;flex-direction:column;gap:.45rem}
.toast{display:flex;align-items:center;gap:.7rem;padding:.85rem 1.1rem;border-radius:var(--r2);font-size:.85rem;font-weight:500;box-shadow:0 8px 30px rgba(0,0,0,.25);animation:tin .3s ease;min-width:240px}
@keyframes tin{from{transform:translateX(180px);opacity:0}to{transform:translateX(0);opacity:1}}
.toast.ok{background:var(--G);color:#fff}
.toast.err{background:var(--R);color:#fff}
.toast.info{background:var(--P);color:#fff}

/* ‚îÄ‚îÄ LOADER ‚îÄ‚îÄ */
#loader{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);z-index:9998;display:none;align-items:center;justify-content:center}
#loader.on{display:flex}
.ld{background:var(--card);border-radius:var(--r2);padding:1.75rem 2.5rem;text-align:center;border:1.5px solid var(--border)}
.spin{width:44px;height:44px;border:3px solid var(--border);border-top-color:var(--P);border-radius:50%;animation:rot 1s linear infinite;margin:0 auto .85rem}
@keyframes rot{to{transform:rotate(360deg)}}

/* ‚îÄ‚îÄ SETUP CONFIG ‚îÄ‚îÄ */
.cfg-step{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r2);padding:1.4rem;margin-bottom:.75rem}
.step-n{display:inline-flex;align-items:center;justify-content:center;width:26px;height:26px;border-radius:50%;background:var(--P);color:#fff;font-weight:800;font-size:.8rem;flex-shrink:0;margin-right:.6rem}
.info-box{background:rgba(92,53,232,.07);border:1.5px solid rgba(92,53,232,.2);border-radius:var(--r);padding:1rem;font-size:.83rem;color:var(--ink2);line-height:1.6}
.info-box code{background:rgba(92,53,232,.12);color:var(--P);padding:.1rem .4rem;border-radius:5px;font-size:.85em}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:720px){
  .form-row,.opt-grid,.stat-grid,.phys-row{grid-template-columns:1fr 1fr}
  .stat-grid{grid-template-columns:1fr 1fr}
  .dash-title{font-size:2rem}
  nav{gap:.4rem;padding:0 .9rem}
  .btn span{display:none}
}
@media(max-width:440px){
  .opt-grid{grid-template-columns:1fr}
  .form-row{grid-template-columns:1fr}
  .dash-title{font-size:1.7rem}
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê BOOT SCREEN ‚ïê‚ïê -->
<div id="boot">
  <div class="boot-brand">Salt<b>Sync</b> Report</div>
  <div class="boot-track"><div class="boot-bar"></div></div>
  <div class="boot-status" id="bootSt">Starting up‚Ä¶</div>
</div>

<!-- ‚ïê‚ïê NAV ‚ïê‚ïê -->
<nav>
  <a class="brand" href="#" onclick="go('dash')">Salt<b>Sync</b></a>
  <span class="status-pill" id="pill"><span class="status-dot pulse"></span> Loading</span>
  <button class="btn btn-ghost btn-sm" onclick="toggleDark()"><i class="fas fa-moon" id="thIcon"></i></button>
  <button class="btn btn-ghost btn-sm" onclick="go('portal')"><i class="fas fa-user"></i> <span>My Reports</span></button>
  <button class="btn btn-p btn-sm" onclick="showAdminGate()"><i class="fas fa-shield-halved"></i> <span>Admin</span></button>
</nav>

<!-- ‚ïê‚ïê NOTIFICATION ‚ïê‚ïê -->
<div id="notifBar"><i class="fas fa-bell" style="margin-right:.4rem"></i><span id="notifTxt">Loading‚Ä¶</span></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- FIRST-TIME CONFIG (admin only sees this once) -->
<div class="page fcenter" id="pConfig">
  <div class="wrap-md">
    <div class="card" style="margin-bottom:1rem">
      <h2 style="margin-bottom:.5rem"><i class="fas fa-plug" style="color:var(--P)"></i> One-Time Cloud Setup</h2>
      <p style="color:var(--ink3);font-size:.88rem">You only do this ONCE. After setup, all employees just open the link ‚Äî no setup needed for them.</p>
    </div>
    <div class="cfg-step">
      <h6><span class="step-n">1</span>Create free Firebase project</h6>
      <div style="font-size:.85rem;color:var(--ink3);margin:.5rem 0">Go to <a href="https://console.firebase.google.com" target="_blank" style="color:var(--P);font-weight:600">console.firebase.google.com</a> ‚Üí Add project ‚Üí any name ‚Üí Continue ‚Üí Disable Analytics ‚Üí Create Project</div>
    </div>
    <div class="cfg-step">
      <h6><span class="step-n">2</span>Create Realtime Database</h6>
      <div style="font-size:.85rem;color:var(--ink3);margin:.5rem 0">Build ‚Üí Realtime Database ‚Üí Create Database ‚Üí Start in <b>test mode</b> ‚Üí Enable</div>
    </div>
    <div class="cfg-step">
      <h6><span class="step-n">3</span>Get your database URL</h6>
      <div style="font-size:.85rem;color:var(--ink3);margin:.5rem 0">Copy the URL shown (looks like: <code style="background:var(--bg3);padding:.1rem .4rem;border-radius:4px;font-size:.82rem">https://your-app-default-rtdb.firebaseio.com</code>)</div>
    </div>
    <div class="cfg-step">
      <div class="fld" style="margin-bottom:.85rem">
        <label>Firebase Database URL</label>
        <input type="url" id="cfgUrl" placeholder="https://your-app-default-rtdb.firebaseio.com">
      </div>
      <div class="info-box" style="margin-bottom:1rem">
        <i class="fas fa-info-circle" style="color:var(--P)"></i> Once you click Connect, <b>all your employees just open the website</b> ‚Äî no setup, no API keys, nothing technical required from them.
      </div>
      <div style="display:flex;gap:.75rem;flex-wrap:wrap">
        <button class="btn btn-p btn-full" style="flex:1" onclick="doSetup()"><i class="fas fa-plug"></i> Connect & Go Live</button>
        <button class="btn btn-ghost" onclick="useLocal()" style="padding:.8rem 1.2rem"><i class="fas fa-hdd"></i></button>
      </div>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div class="page" id="pDash">
  <div class="wrap">
    <div class="dash-hero">
      <h1 class="dash-title">Daily Reports<br><span class="grad">Made Simple.</span></h1>
      <div class="dash-sub">Generate, save & track ‚Äî everything synced to cloud automatically.</div>
      <div class="opt-grid">
        <div class="opt-card emp" onclick="go('empRep')">
          <div class="opt-ico"><i class="fas fa-clipboard-list"></i></div>
          <div class="opt-name">Daily Issue Report</div>
          <div class="opt-desc">Employee daily log ‚Äî issues, physical support & processing.</div>
          <div class="opt-go">Start <i class="fas fa-arrow-right"></i></div>
        </div>
        <div class="opt-card tl" onclick="go('tlRep')">
          <div class="opt-ico"><i class="fas fa-chart-line"></i></div>
          <div class="opt-name">Team Leader Report</div>
          <div class="opt-desc">Full shift overview ‚Äî remote, physical, processing breakdown.</div>
          <div class="opt-go">Start <i class="fas fa-arrow-right"></i></div>
        </div>
      </div>
      <div style="margin-top:1.75rem;font-size:.8rem;color:var(--ink3)"><i class="fas fa-cloud" style="margin-right:.3rem"></i>Reports auto-saved to cloud¬∑Devops by Safikul Islam</div>
    </div>
  </div>
</div>

<!-- EMPLOYEE REPORT -->
<div class="page" id="pEmpRep">
  <div class="wrap-md">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.25rem">
      <div><h2 style="letter-spacing:-.5px">Daily Issue Report</h2><div style="font-size:.82rem;color:var(--ink3)">Fill in and save to cloud</div></div>
      <button class="btn btn-ghost btn-sm" onclick="go('dash')"><i class="fas fa-arrow-left"></i> Back</button>
    </div>
    <div class="card">
      <div class="form-row" style="margin-bottom:1rem">
        <div class="fld"><label>Date</label><input type="date" id="eDate"></div>
        <div class="fld"><label>Select Employee</label>
          <select id="eNameSel" onchange="fillEmp()"><option value="">‚Äî Select ‚Äî</option></select></div>
        <div class="fld"><label>Employee Name</label><input type="text" id="eName" placeholder="Full name"></div>
        <div class="fld"><label>Employee ID</label><input type="text" id="eId" placeholder="Salt-S-XXX" readonly style="opacity:.65"></div>
        <div class="fld"><label>Duty Shift</label>
          <select id="eShift"><option value="">‚Äî Select Shift ‚Äî</option><option>Day</option><option>Evening</option><option>Night</option></select></div>
        <div class="fld full"><label>Issues <span style="color:var(--ink3);font-weight:400">(one per line)</span></label>
          <textarea id="eIssues" placeholder="Type each issue on a new line‚Ä¶"></textarea></div>
      </div>

      <div class="sec p-sec">
        <div class="sec-head"><span class="sec-ico p-ico"><i class="fas fa-hands-helping"></i></span>Physical Support Count</div>
        <div style="display:flex;align-items:center;gap:1rem">
          <input type="number" class="number-inp" id="ePhys" value="0" min="0" onchange="prevPhys()">
          <span style="font-size:.82rem;color:var(--ink3)">Adds to total received & solved automatically.</span>
        </div>
        <div id="physNote"></div>
      </div>

      <div class="sec p-sec">
        <div class="sec-head"><span class="sec-ico p-ico"><i class="fas fa-list-ol"></i></span>SS Numbers / Processing Issues</div>
        <textarea class="inline-ta" id="eSS" placeholder="Paste SS numbers, one per line‚Ä¶"></textarea>
      </div>

      <div class="sec p-sec">
        <div class="sec-head"><span class="sec-ico p-ico"><i class="fas fa-star"></i></span>Special Task / Note</div>
        <textarea class="inline-ta" id="eSpecial" placeholder="Any special accomplishments or notes‚Ä¶" style="min-height:75px"></textarea>
      </div>

      <div style="display:flex;gap:.65rem;justify-content:flex-end;margin-top:1.25rem;flex-wrap:wrap">
        <button class="btn btn-ghost btn-sm" onclick="copyOut('eOut')"><i class="fas fa-copy"></i> Copy</button>
        <button class="btn btn-p" onclick="genEmp()"><i class="fas fa-cloud-upload-alt"></i> Generate & Save</button>
      </div>

      <div class="out-wrap" id="eOut">
        <div class="out-topbar">
          <div><span class="out-dot" style="background:#ff5f57"></span><span class="out-dot" style="background:#febc2e"></span><span class="out-dot" style="background:#28c840"></span></div>
          <span style="font-size:.75rem;color:rgba(255,255,255,.4)">report.txt</span>
          <button onclick="copyOut('eOut')" style="background:rgba(255,255,255,.1);border:none;color:rgba(255,255,255,.6);padding:.25rem .6rem;border-radius:6px;font-size:.75rem;cursor:pointer"><i class="fas fa-copy"></i> copy</button>
        </div>
        <pre class="out-pre" id="eOutPre"></pre>
      </div>
    </div>
  </div>
</div>

<!-- TL REPORT -->
<div class="page" id="pTlRep">
  <div class="wrap-md">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.25rem">
      <div><h2 style="letter-spacing:-.5px;color:var(--T)">Team Leader Report</h2><div style="font-size:.82rem;color:var(--ink3)">Full shift breakdown ‚Äî saved to cloud</div></div>
      <button class="btn btn-ghost btn-sm" onclick="go('dash')"><i class="fas fa-arrow-left"></i> Back</button>
    </div>
    <div class="card">
      <div class="form-row" style="margin-bottom:1rem">
        <div class="fld"><label>Date</label><input type="date" id="tDate"></div>
        <div class="fld"><label>TL Name</label>
          <select id="tName"><option value="">‚Äî Select TL ‚Äî</option><option>Safikul Islam</option><option>S.M Faisal</option></select></div>
        <div class="fld full"><label>Report Shift</label>
          <select id="tShift"><option value="">‚Äî Select ‚Äî</option>
            <option value="Day (9:00AM to 6:30PM)">Day (9:00AM to 6:30PM)</option>
            <option value="All Day (9:00AM to 9:00AM)">All Day (9:00AM to 9:00AM)</option>
            <option>Evening</option><option>Night</option></select></div>
        <div class="fld full"><label>List of Issues <span style="font-weight:400;color:var(--ink3)">(one per line)</span></label>
          <textarea id="tIssues" placeholder="Enter issues‚Ä¶" oninput="updateOv()"></textarea></div>
      </div>

      <div class="sec tl-sec">
        <div class="sec-head"><span class="sec-ico t-ico"><i class="fas fa-users"></i></span>Processing Responsible Persons</div>
        <input type="text" id="tPersons" value="Shamsur + Rony" style="background:var(--bg);border:1.5px solid var(--border);border-radius:var(--r);padding:.65rem 1rem;width:100%;color:var(--ink);outline:none;font-family:'DM Sans',sans-serif;transition:border-color var(--tr)">
      </div>

      <div class="sec tl-sec">
        <div class="sec-head" style="justify-content:space-between">
          <div style="display:flex;align-items:center;gap:.5rem"><span class="sec-ico t-ico"><i class="fas fa-chart-bar"></i></span>TL Overview</div>
          <span class="badge b-gray" id="ovBadge">0 repeated</span>
        </div>
        <div id="tlOvList"><div style="text-align:center;padding:1.2rem;color:var(--ink3);font-size:.83rem">Type issues above to see automatic overview</div></div>
        <div style="margin-top:1rem;padding:.85rem 1rem;background:rgba(0,184,156,.05);border-radius:var(--r);border-left:3px solid var(--T)">
          <div style="font-size:.78rem;font-weight:700;color:var(--T);margin-bottom:.4rem"><i class="fas fa-tags"></i> Keywords</div>
          <div id="kwList"></div>
        </div>
      </div>

      <div class="sec p-sec">
        <div class="sec-head"><span class="sec-ico p-ico"><i class="fas fa-tools"></i></span>Physical Support Issues</div>
        <textarea class="inline-ta" id="tPhys" placeholder="ONT replacement - done&#10;Fiber splicing - shift&#10;Router setup - cancel" oninput="updatePhys()"></textarea>
        <div class="hint">done/fixed/solved ‚Üí Complete &bull; shift/pending ‚Üí Shift &bull; cancel ‚Üí Cancel</div>
        <div id="physSum" style="display:none"><div class="phys-row" id="physGrid"></div></div>
      </div>

      <div class="sec tl-sec">
        <div class="sec-head"><span class="sec-ico t-ico"><i class="fas fa-list-ol"></i></span>SS Numbers / Processing</div>
        <textarea class="inline-ta" id="tSS" placeholder="Paste SS numbers here‚Ä¶"></textarea>
      </div>

      <div style="display:flex;gap:.65rem;justify-content:flex-end;margin-top:1.25rem;flex-wrap:wrap">
        <button class="btn btn-ghost btn-sm" onclick="copyOut('tOut')"><i class="fas fa-copy"></i> Copy</button>
        <button class="btn btn-t" onclick="genTL()"><i class="fas fa-cloud-upload-alt"></i> Generate & Save</button>
      </div>

      <div class="out-wrap" id="tOut">
        <div class="out-topbar">
          <div><span class="out-dot" style="background:#ff5f57"></span><span class="out-dot" style="background:#febc2e"></span><span class="out-dot" style="background:#28c840"></span></div>
          <span style="font-size:.75rem;color:rgba(255,255,255,.4)">tl-report.txt</span>
          <button onclick="copyOut('tOut')" style="background:rgba(255,255,255,.1);border:none;color:rgba(255,255,255,.6);padding:.25rem .6rem;border-radius:6px;font-size:.75rem;cursor:pointer"><i class="fas fa-copy"></i> copy</button>
        </div>
        <pre class="out-pre" id="tOutPre"></pre>
      </div>
    </div>
  </div>
</div>

<!-- EMPLOYEE PORTAL -->
<div class="page" id="pPortal">
  <div class="wrap-md">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.25rem">
      <div><h2>My Reports</h2><div style="font-size:.82rem;color:var(--ink3)">View your personal report history from the cloud</div></div>
      <button class="btn btn-ghost btn-sm" onclick="go('dash')"><i class="fas fa-arrow-left"></i> Back</button>
    </div>
    <div class="card-flat card-sm" style="margin-bottom:1rem">
      <div style="display:flex;gap:.75rem;align-items:flex-end;flex-wrap:wrap">
        <div class="fld" style="flex:1;min-width:180px"><label>Select Your Name</label>
          <select id="portalSel" onchange="loadPortal()"><option value="">‚Äî Who are you? ‚Äî</option></select></div>
        <button class="btn btn-p btn-sm" onclick="loadPortal()"><i class="fas fa-sync"></i> Refresh</button>
      </div>
    </div>
    <div id="portalList">
      <div style="text-align:center;padding:3rem;color:var(--ink3)"><i class="fas fa-user-circle" style="font-size:3rem;opacity:.2;display:block;margin-bottom:.7rem"></i>Select your name above to view your reports</div>
    </div>
  </div>
</div>

<!-- ADMIN GATE -->
<div class="page fcenter" id="pAdminGate">
  <div class="wrap-sm">
    <div class="lock-wrap locked" id="lockIco"><i class="fas fa-lock"></i></div>
    <h2 style="text-align:center;margin-bottom:.35rem">Admin Access</h2>
    <p style="text-align:center;color:var(--ink3);font-size:.88rem;margin-bottom:1.5rem">Enter password to continue</p>
    <div class="card" id="loginCard">
      <div class="fld" style="margin-bottom:.85rem">
        <label>Password</label>
        <input type="password" id="aPass" placeholder="Admin password" onkeydown="if(event.key==='Enter')doLogin()">
      </div>
      <div id="loginErr" style="display:none;background:rgba(239,68,68,.08);border:1.5px solid rgba(239,68,68,.2);border-radius:var(--r);padding:.65rem .9rem;font-size:.83rem;color:var(--R);margin-bottom:.85rem"><i class="fas fa-exclamation-triangle"></i> <span id="loginErrTxt"></span></div>
      <button class="btn btn-p btn-full" onclick="doLogin()"><i class="fas fa-unlock-alt"></i> Login</button>
      <button class="btn btn-ghost btn-full" style="margin-top:.5rem" onclick="go('dash')">Cancel</button>
      <div style="text-align:center;margin-top:1rem;font-size:.75rem;color:var(--ink3)">Default password: <code style="color:var(--P);font-size:.82rem">admin</code></div>
    </div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div class="page" id="pAdmin">
  <div class="wrap">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;flex-wrap:wrap;gap:.75rem">
      <h2 style="letter-spacing:-.5px"><i class="fas fa-shield-halved" style="color:var(--P)"></i> Admin Panel</h2>
      <div style="display:flex;gap:.5rem">
        <button class="btn btn-ghost btn-sm" onclick="go('dash')"><i class="fas fa-arrow-left"></i> Dashboard</button>
        <button class="btn btn-r btn-sm" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="stat-grid">
      <div class="stat-box"><div class="stat-num num-p" id="s0">0</div><div class="stat-lbl">Employee Reports</div></div>
      <div class="stat-box"><div class="stat-num num-t" id="s1">0</div><div class="stat-lbl">TL Reports</div></div>
      <div class="stat-box"><div class="stat-num num-g" id="s2">0</div><div class="stat-lbl">Total Issues</div></div>
      <div class="stat-box"><div class="stat-num num-y" id="s3">0</div><div class="stat-lbl">Issues Solved</div></div>
    </div>

    <!-- Tabs -->
    <div class="tab-bar">
      <button class="tab on" onclick="tab(this,'tER')"><i class="fas fa-users"></i> Emp Reports</button>
      <button class="tab" onclick="tab(this,'tTL')"><i class="fas fa-user-check"></i> TL Reports</button>
      <button class="tab" onclick="tab(this,'tEmps')"><i class="fas fa-users-cog"></i> Employees</button>
      <button class="tab" onclick="tab(this,'tNotif')"><i class="fas fa-bell"></i> Notification</button>
      <button class="tab" onclick="tab(this,'tSec')"><i class="fas fa-key"></i> Security</button>
      <button class="tab" onclick="tab(this,'tDB')"><i class="fas fa-database"></i> Database</button>
    </div>

    <!-- Employee Reports -->
    <div class="tp on" id="tER">
      <div class="tbl-card">
        <div class="tbl-search"><i class="fas fa-search" style="color:var(--ink3)"></i><input id="eSearch" placeholder="Search by name or date‚Ä¶" oninput="filterET()"></div>
        <div style="overflow-x:auto"><table>
          <thead><tr><th>Date</th><th>Employee</th><th>Shift</th><th>Issues</th><th>Solved</th><th>Physical</th><th>Special</th><th></th></tr></thead>
          <tbody id="eTBody"></tbody>
        </table></div>
      </div>
    </div>

    <!-- TL Reports -->
    <div class="tp" id="tTL">
      <div class="tbl-card">
        <div class="tbl-search"><i class="fas fa-search" style="color:var(--ink3)"></i><input id="tSearch" placeholder="Search by TL or date‚Ä¶" oninput="filterTT()"></div>
        <div style="overflow-x:auto"><table>
          <thead><tr><th>Date</th><th>TL</th><th>Shift</th><th>Issues</th><th>Solved</th><th>Physical</th><th>Processing</th><th></th></tr></thead>
          <tbody id="tTBody"></tbody>
        </table></div>
      </div>
    </div>

    <!-- Employees -->
    <div class="tp" id="tEmps">
      <div class="card" style="margin-bottom:1rem">
        <h4 style="margin-bottom:1rem"><i class="fas fa-user-plus" style="color:var(--P)"></i> Add Employee</h4>
        <div style="display:flex;gap:.75rem;flex-wrap:wrap;align-items:flex-end">
          <div class="fld" style="flex:2;min-width:160px"><label>Full Name</label><input id="nEName" placeholder="Full name"></div>
          <div class="fld" style="flex:1;min-width:130px"><label>Employee ID</label><input id="nEId" placeholder="Salt-S-XXX"></div>
          <button class="btn btn-g" onclick="addEmp()"><i class="fas fa-plus"></i> Add</button>
        </div>
      </div>
      <div class="card"><h4 style="margin-bottom:1rem"><i class="fas fa-list" style="color:var(--P)"></i> All Employees</h4><div id="empMgList"></div></div>
    </div>

    <!-- Notification -->
    <div class="tp" id="tNotif">
      <div class="card">
        <h4 style="margin-bottom:.4rem"><i class="fas fa-bell" style="color:var(--P)"></i> Notification Banner</h4>
        <p style="color:var(--ink3);font-size:.85rem;margin-bottom:1rem">Shows at the top for all users. Change anytime.</p>
        <div class="fld"><label>Message</label><textarea id="notifInp" rows="2" placeholder="Enter notification‚Ä¶"></textarea></div>
        <div style="display:flex;gap:.65rem;margin-top:.85rem">
          <button class="btn btn-p" onclick="saveNotif()"><i class="fas fa-save"></i> Save & Publish</button>
          <button class="btn btn-ghost" onclick="previewNotif()"><i class="fas fa-eye"></i> Preview</button>
        </div>
      </div>
    </div>

    <!-- Security -->
    <div class="tp" id="tSec">
      <div class="card">
        <h4 style="margin-bottom:.4rem"><i class="fas fa-key" style="color:var(--P)"></i> Change Admin Password</h4>
        <p style="color:var(--ink3);font-size:.85rem;margin-bottom:1rem">Default is <code style="color:var(--P)">admin</code> ‚Äî change it now.</p>
        <div class="form-row" style="margin-bottom:.85rem">
          <div class="fld"><label>Current Password</label><input type="password" id="curP" placeholder="Current"></div>
          <div class="fld" style="display:none"></div>
          <div class="fld"><label>New Password</label><input type="password" id="newP" placeholder="New (min 4 chars)"></div>
          <div class="fld"><label>Confirm New</label><input type="password" id="newP2" placeholder="Repeat"></div>
        </div>
        <div style="display:flex;gap:.65rem;flex-wrap:wrap">
          <button class="btn btn-p" onclick="changePwd()"><i class="fas fa-save"></i> Update Password</button>
        </div>
        <hr style="margin:1.5rem 0;border:none;border-top:1.5px solid var(--border)">
        <h4 style="margin-bottom:.4rem"><i class="fas fa-undo" style="color:var(--Y)"></i> Emergency Reset</h4>
        <p style="color:var(--ink3);font-size:.85rem;margin-bottom:.85rem">Resets password back to <code style="color:var(--P)">admin</code>. Use only if locked out.</p>
        <button class="btn btn-ghost" onclick="resetPwd()"><i class="fas fa-undo"></i> Reset to "admin"</button>
      </div>
    </div>

    <!-- Database -->
    <div class="tp" id="tDB">
      <div class="card">
        <h4 style="margin-bottom:1rem"><i class="fas fa-database" style="color:var(--P)"></i> Database Info</h4>
        <div style="display:grid;gap:.6rem;margin-bottom:1.5rem">
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.8rem 1rem;background:var(--bg2);border-radius:var(--r)"><span style="font-weight:600;font-size:.88rem">Status</span><span class="badge" id="dbSt">‚Äî</span></div>
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.8rem 1rem;background:var(--bg2);border-radius:var(--r)"><span style="font-weight:600;font-size:.88rem">Mode</span><span class="badge b-p" id="dbMode">‚Äî</span></div>
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.8rem 1rem;background:var(--bg2);border-radius:var(--r)"><span style="font-weight:600;font-size:.88rem">Firebase URL</span><span style="font-size:.78rem;color:var(--ink3);font-family:monospace" id="dbUrl">‚Äî</span></div>
          <div style="display:flex;justify-content:space-between;align-items:center;padding:.8rem 1rem;background:var(--bg2);border-radius:var(--r)"><span style="font-weight:600;font-size:.88rem">Total Records</span><span class="badge b-p" id="dbCount">0</span></div>
        </div>
        <div class="fld" style="margin-bottom:.85rem">
          <label>Update Firebase URL (if changing project)</label>
          <input type="url" id="newDbUrl" placeholder="https://new-project.firebaseio.com">
        </div>
        <div style="display:flex;gap:.65rem;flex-wrap:wrap">
          <button class="btn btn-p" onclick="reconnect()"><i class="fas fa-plug"></i> Reconnect</button>
          <button class="btn btn-r" onclick="clearCfg()"><i class="fas fa-trash-alt"></i> Clear Config</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê MODAL ‚ïê‚ïê -->
<div class="modal-bg" id="modal" onclick="closeModal(event)">
  <div class="modal">
    <button onclick="closeModal()" style="position:absolute;top:1rem;right:1rem;background:var(--bg3);border:none;width:30px;height:30px;border-radius:50%;cursor:pointer;color:var(--ink3);transition:var(--tr)" onmouseover="this.style.background='var(--R)';this.style.color='#fff'" onmouseout="this.style.background='var(--bg3)';this.style.color='var(--ink3)'"><i class="fas fa-times"></i></button>
    <h4><i class="fas fa-file-alt" style="color:var(--P)"></i> Report Details</h4>
    <pre id="modalPre"></pre>
    <button class="btn btn-p btn-sm" style="margin-top:.85rem" onclick="cpModal()"><i class="fas fa-copy"></i> Copy</button>
  </div>
</div>

<!-- ‚ïê‚ïê LOADER ‚ïê‚ïê -->
<div id="loader"><div class="ld"><div class="spin"></div><div id="ldTxt" style="font-weight:600;font-size:.9rem">Processing‚Ä¶</div></div></div>

<!-- ‚ïê‚ïê TOASTS ‚ïê‚ïê -->
<div id="toasts"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONSTANTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CFG_K  = 'srp_fb_url';
const PASS_K = 'srp_pass';
const MODE_K = 'srp_mode';
const NOTIF_K= 'srp_notif';

const FIXED_ISSUES = {
  'Slow Issues':['slow','slow internet','speed issue','slow speed'],
  'Direct Call':['direct call'],'QC Call':['qc call'],
  'Solved':['solved','done','fixed'],
  'Billing Issues':['billing','bill','payment','invoice'],
  'No Internet':['no internet','internet down','offline'],
  'Disconnect Issue':['disconnect','disconnected'],
  'Loss':['loss','packet loss'],
  'Pack Change':['pack update','pack upgrade','pack downgrade','package change'],
  'Power Check':['power','power check'],'Shifting':['shifting','relocation'],
  'Site Browsing Issue':['site issue','website problem','browsing issue'],
  'Gaming Issue':['game','gaming','ping','latency'],'General Task':['general'],
  'Reconnection':['reconnect','reconnection'],'New Line':['new line','new connection'],
  'Public IP Need':['public ip'],'FTP Issue':['ftp'],'Info':['info','information']
};

const DEFAULT_EMPS = [
  {name:"Sujan Tarafdar",eid:"Salt-S-063"},
  {name:"Md Safikul Islam",eid:"Salt-S-076"},
  {name:"Sajid Hossain",eid:"Salt-S-077"},
  {name:"Md. Shamsur Rahman",eid:"Salt-S-049"},
  {name:"Md. Muhaimin Nabi",eid:"Salt-S-094"},
  {name:"Rony Bine",eid:"Salt-S-096"},
  {name:"MD Shakib",eid:"Salt-S-080"},
  {name:"GM Sakib",eid:"Salt-S-087"}
];

let DB_URL = '';          // Firebase base URL (no trailing slash)
let CLOUD  = false;       // true when Firebase connected
let IS_ADMIN = false;
let empCache = {};        // {name: eid}
let allER = [];           // all employee reports cache
let allTL = [];           // all TL reports cache

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.onload = async () => {
  loadTheme();
  setBoot('Checking configuration‚Ä¶');

  const url  = localStorage.getItem(CFG_K);
  const mode = localStorage.getItem(MODE_K);

  if (!url && mode !== 'local') {
    endBoot(); go('config'); setPill('err','Setup needed'); return;
  }

  if (url) {
    DB_URL = url.replace(/\/+$/, '');
    CLOUD  = true;
    setBoot('Connecting to Firebase‚Ä¶');
    try {
      await fbGet('settings/ping');
      setPill('ok','Cloud Connected');
    } catch(e) {
      // First time ‚Äî create initial data
      try {
        await fbSet('settings', { notification:'Welcome to SaltSync Report Pro! üéâ', adminPass:'admin', ping:1 });
        await fbSet('employees', Object.fromEntries(DEFAULT_EMPS.map(e=>[slugify(e.name),e])));
        setPill('ok','Cloud Connected');
      } catch(e2) {
        setPill('err','Firebase Error'); console.error(e2);
      }
    }
  } else {
    CLOUD = false;
    setPill('','Local Mode');
    initLocalEmps();
  }

  setBoot('Loading data‚Ä¶');
  await refreshEmpCache();
  loadNotif();
  buildKw();
  endBoot();
  go('dash');
};

function setBoot(t){ document.getElementById('bootSt').textContent = t; }
function endBoot(){
  setTimeout(()=>{
    const b=document.getElementById('boot');
    b.style.opacity='0';
    setTimeout(()=>b.style.display='none',500);
  },1400);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIREBASE REST API
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function fbGet(path){
  const r = await fetch(`${DB_URL}/${path}.json`);
  if(!r.ok) throw new Error(`GET ${path} ‚Üí ${r.status}`);
  return r.json();
}
async function fbSet(path, data){
  const r = await fetch(`${DB_URL}/${path}.json`,{method:'PUT',body:JSON.stringify(data),headers:{'Content-Type':'application/json'}});
  if(!r.ok) throw new Error(`SET ${path} ‚Üí ${r.status}`);
  return r.json();
}
async function fbPush(path, data){
  const r = await fetch(`${DB_URL}/${path}.json`,{method:'POST',body:JSON.stringify(data),headers:{'Content-Type':'application/json'}});
  if(!r.ok) throw new Error(`PUSH ${path} ‚Üí ${r.status}`);
  const j = await r.json();
  return j.name; // Firebase push ID
}
async function fbDelete(path){
  const r = await fetch(`${DB_URL}/${path}.json`,{method:'DELETE'});
  if(!r.ok) throw new Error(`DEL ${path} ‚Üí ${r.status}`);
}
async function fbPatch(path, data){
  const r = await fetch(`${DB_URL}/${path}.json`,{method:'PATCH',body:JSON.stringify(data),headers:{'Content-Type':'application/json'}});
  if(!r.ok) throw new Error(`PATCH ${path} ‚Üí ${r.status}`);
}

function slugify(s){ return s.toLowerCase().replace(/[^a-z0-9]/g,'-'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function doSetup(){
  const url = v('cfgUrl').trim().replace(/\/+$/,'');
  if(!url){ toast('Enter Firebase URL','err'); return; }
  ld('Connecting to Firebase‚Ä¶');
  try {
    // Test write
    await fetch(`${url}/settings.json`,{method:'PUT',body:JSON.stringify({notification:'Welcome to SaltSync Report Pro! üéâ',adminPass:'admin',ping:1}),headers:{'Content-Type':'application/json'}});
    // Seed employees
    const emps = {};
    DEFAULT_EMPS.forEach(e=>{ emps[slugify(e.name)]=e; });
    await fetch(`${url}/employees.json`,{method:'PUT',body:JSON.stringify(emps),headers:{'Content-Type':'application/json'}});

    localStorage.setItem(CFG_K, url);
    localStorage.removeItem(MODE_K);
    hideLD(); toast('Connected! Loading app‚Ä¶');
    setTimeout(()=>location.reload(),1000);
  } catch(e){ hideLD(); toast('Connection failed: '+e.message,'err'); }
}

function useLocal(){
  localStorage.setItem(MODE_K,'local');
  localStorage.removeItem(CFG_K);
  location.reload();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMPLOYEES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initLocalEmps(){
  try{ empCache=JSON.parse(localStorage.getItem('srp_emps')||'{}'); }catch{empCache={};}
  if(!Object.keys(empCache).length){ DEFAULT_EMPS.forEach(e=>{empCache[e.name]=e.eid;}); saveLocalEmps(); }
}
function saveLocalEmps(){ localStorage.setItem('srp_emps',JSON.stringify(empCache)); }

async function refreshEmpCache(){
  if(CLOUD){
    const d = await fbGet('employees');
    empCache={};
    if(d) Object.values(d).forEach(e=>{ empCache[e.name]=e.eid; });
  } else { initLocalEmps(); }
  populateEmpDropdowns();
}

function populateEmpDropdowns(){
  const names = Object.keys(empCache).sort();
  ['eNameSel','portalSel'].forEach(id=>{
    const s=document.getElementById(id);
    if(!s)return;
    const was = s.value;
    s.innerHTML='<option value="">‚Äî Select ‚Äî</option>';
    names.forEach(n=>s.innerHTML+=`<option value="${n}"${n===was?' selected':''}>${n}</option>`);
  });
}

async function addEmp(){
  const name=v('nEName').trim(), eid=v('nEId').trim();
  if(!name||!eid){toast('Enter both name and ID','err');return;}
  if(empCache[name]){toast('Employee already exists','err');return;}
  ld('Adding‚Ä¶');
  try{
    if(CLOUD){ await fbPatch('employees',{[slugify(name)]:{name,eid}}); }
    empCache[name]=eid;
    if(!CLOUD) saveLocalEmps();
    sv('nEName',''); sv('nEId','');
    await loadEmpMgmt();
    populateEmpDropdowns();
    hideLD(); toast(name+' added!');
  } catch(e){ hideLD(); toast(e.message,'err'); }
}

async function removeEmp(name){
  if(!confirm('Remove '+name+'?')) return;
  ld('Removing‚Ä¶');
  try{
    if(CLOUD){ await fbDelete('employees/'+slugify(name)); }
    delete empCache[name];
    if(!CLOUD) saveLocalEmps();
    await loadEmpMgmt();
    populateEmpDropdowns();
    hideLD(); toast(name+' removed');
  } catch(e){ hideLD(); toast(e.message,'err'); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTIFICATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadNotif(){
  let txt = localStorage.getItem(NOTIF_K)||'Welcome to SaltSync Report Pro! üéâ';
  if(CLOUD){
    try{ const s=await fbGet('settings'); txt=s.notification||txt; }catch{}
  }
  document.getElementById('notifTxt').textContent=txt;
  localStorage.setItem(NOTIF_K, txt);
}

async function saveNotif(){
  const txt=v('notifInp').trim();
  if(!txt){toast('Enter text','err');return;}
  ld('Saving‚Ä¶');
  try{
    if(CLOUD) await fbPatch('settings',{notification:txt});
    localStorage.setItem(NOTIF_K,txt);
    document.getElementById('notifTxt').textContent=txt;
    hideLD(); toast('Notification published!');
  } catch(e){ hideLD(); toast(e.message,'err'); }
}
function previewNotif(){
  document.getElementById('notifTxt').textContent=v('notifInp')||'(empty)';
  toast('Previewing in banner','info');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN PASSWORD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getAdminPass(){ return localStorage.getItem(PASS_K)||'admin'; }

async function syncAdminPass(){
  if(CLOUD){
    try{ const s=await fbGet('settings'); if(s.adminPass) localStorage.setItem(PASS_K,s.adminPass); }catch{}
  }
}

async function changePwd(){
  const cur=v('curP'), np=v('newP'), np2=v('newP2');
  if(cur!==getAdminPass()){toast('Current password wrong','err');return;}
  if(np.length<4){toast('Min 4 characters','err');return;}
  if(np!==np2){toast("Passwords don't match",'err');return;}
  ld('Updating‚Ä¶');
  try{
    if(CLOUD) await fbPatch('settings',{adminPass:np});
    localStorage.setItem(PASS_K,np);
    sv('curP','');sv('newP','');sv('newP2','');
    hideLD(); toast('Password updated!');
  } catch(e){ hideLD(); toast(e.message,'err'); }
}

async function resetPwd(){
  if(!confirm('Reset password to "admin"?')) return;
  ld('Resetting‚Ä¶');
  try{
    if(CLOUD) await fbPatch('settings',{adminPass:'admin'});
    localStorage.setItem(PASS_K,'admin');
    hideLD(); toast('Password reset to "admin"');
  } catch(e){ hideLD(); toast(e.message,'err'); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PAGE_MAP = {
  config:'pConfig',dash:'pDash',empRep:'pEmpRep',
  tlRep:'pTlRep',portal:'pPortal',adminGate:'pAdminGate',admin:'pAdmin'
};

function go(name){
  Object.values(PAGE_MAP).forEach(id=>{
    const el=document.getElementById(id);
    if(el){el.classList.remove('on');el.style.display='none';}
  });
  const pg=document.getElementById(PAGE_MAP[name]);
  if(!pg)return;
  const isFlex=['config','adminGate'].includes(name);
  pg.style.display=isFlex?'flex':'block';
  setTimeout(()=>pg.classList.add('on'),10);

  if(name==='empRep') initEmpForm();
  if(name==='tlRep')  initTLForm();
  if(name==='portal') initPortal();
  if(name==='admin')  loadAdmin();
}

function showAdminGate(){
  if(IS_ADMIN){go('admin');return;}
  sv('aPass','');
  document.getElementById('loginErr').style.display='none';
  resetLock();
  go('adminGate');
}

function doLogout(){ IS_ADMIN=false; toast('Logged out','info'); go('dash'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN LOGIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function doLogin(){
  await syncAdminPass();
  const pass=v('aPass');
  if(pass===getAdminPass()){
    IS_ADMIN=true;
    setLock('good','fa-unlock-alt');
    setTimeout(()=>{go('admin');resetLock();},600);
  } else {
    setLock('bad','fa-lock');
    document.getElementById('loginErr').style.display='block';
    document.getElementById('loginErrTxt').textContent='Wrong password. Try again.';
    sv('aPass','');
    document.getElementById('loginCard').classList.add('shake');
    setTimeout(()=>{document.getElementById('loginCard').classList.remove('shake');setLock('locked','fa-lock');},500);
  }
}

function setLock(cls,icon){
  const el=document.getElementById('lockIco');
  el.className='lock-wrap '+cls;
  el.innerHTML=`<i class="fas ${icon}"></i>`;
}
function resetLock(){ setLock('locked','fa-lock'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMPLOYEE REPORT FORM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function initEmpForm(){
  document.getElementById('eDate').valueAsDate=new Date();
  const out=document.getElementById('eOut');
  out.classList.remove('show'); out.style.display='none';
  await refreshEmpCache();
}

function fillEmp(){
  const n=v('eNameSel');
  if(n&&empCache[n]){sv('eName',n);sv('eId',empCache[n]);}
}

function prevPhys(){
  const p=parseInt(v('ePhys'))||0;
  document.getElementById('physNote').innerHTML=p>0
    ?`<div style="margin-top:.55rem;padding:.55rem .8rem;background:rgba(92,53,232,.08);border-radius:var(--r);font-size:.8rem;color:var(--P)"><i class="fas fa-info-circle"></i> +${p} added to Total Received & Solved</div>`
    :'';
}

async function genEmp(){
  const date=v('eDate'),name=v('eName').trim(),eid=v('eId').trim();
  const shift=v('eShift');
  const issues=v('eIssues').trim().split('\n').filter(l=>l.trim());
  const special=v('eSpecial').trim();
  const phys=parseInt(v('ePhys'))||0;
  const proc=v('eSS').trim().split(/\r?\n/).map(l=>l.replace(/"/g,'').trim()).filter(l=>l);

  if(!shift){toast('Select a shift','err');return;}
  if(!name||!eid){toast('Select employee name','err');return;}
  if(!issues.length&&!phys){toast('Enter at least one issue','err');return;}

  ld('Generating report‚Ä¶');
  let rd=new Date(date);
  if(shift==='Night')rd.setDate(rd.getDate()-1);
  const df=rd.toLocaleDateString('en-GB').replace(/\//g,'.');

  const ic={};
  issues.forEach(i=>{const k=i.toLowerCase().trim();ic[k]=(ic[k]||0)+1;});
  const uniq={};
  issues.forEach(i=>{const k=i.toLowerCase().trim();if(!uniq[k])uniq[k]=i;});

  const totalRec=issues.length+phys,procCnt=proc.length,solved=totalRec-procCnt;
  let r=`Employee Name: ${name}\nEmployee ID: ${eid}\nDate: ${df}\nDuty Shift: ${shift}\n`;
  r+=`Total Issues Received: ${totalRec}\nTotal Issues Solved: ${solved}\n`;
  r+=procCnt>0?`Total Issues Processing: ${procCnt} ( ${proc.join(' ')} )\n`:`Total Issues Processing: 0\n`;
  r+=`\n------* Type of Issues *------\n`;
  for(const k in ic)r+=`${uniq[k]}: ${ic[k]}\n`;
  if(phys>0)r+=`Physical Support: ${phys}\n`;
  if(special)r+=`\n‚òÖ Special Task/NOTE:\n${special}\n`;

  document.getElementById('eOutPre').textContent=r;
  const out=document.getElementById('eOut');
  out.style.display='block';out.classList.add('show');

  const row={date:df,name,employee_id:eid,shift,issues:totalRec,physical_support:phys,
             regular_issues:issues.length,processing:procCnt,solved,special_task:special,
             report_content:r,ts:Date.now()};
  try{
    if(CLOUD) await fbPush('emp_reports',row);
    else { const a=getLS('srp_er');a.unshift({...row,id:Date.now().toString()});setLS('srp_er',a); }
    toast('Report saved to cloud ‚òÅÔ∏è');
  } catch(e){ toast('Save error: '+e.message,'err'); }
  hideLD();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TL REPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initTLForm(){
  document.getElementById('tDate').valueAsDate=new Date();
  const out=document.getElementById('tOut');
  out.classList.remove('show');out.style.display='none';
  buildKw();updateOv();updatePhys();
}

function norm(t){
  if(!t)return'UNKNOWN';
  const lo=t.toLowerCase();
  for(const[cat,kws]of Object.entries(FIXED_ISSUES)){if(kws.some(k=>lo.includes(k)))return cat;}
  return lo.trim();
}
function getCounts(list){
  const c={};Object.keys(FIXED_ISSUES).forEach(cat=>c[cat]=0);
  list.forEach(t=>{const n=norm(t);if(c[n]!==undefined)c[n]++;});
  return c;
}

function buildKw(){
  const el=document.getElementById('kwList');if(!el)return;
  let h='';
  for(const[cat,kws]of Object.entries(FIXED_ISSUES)){
    h+=`<div style="margin-bottom:.3rem"><b style="font-size:.75rem">${cat}:</b> ${kws.map(k=>`<span class="chip">${k}</span>`).join('')}</div>`;
  }
  el.innerHTML=h;
}

function updateOv(){
  const lines=v('tIssues').split('\n').map(l=>l.trim()).filter(l=>l);
  const counts=getCounts(lines);
  const list=document.getElementById('tlOvList'),badge=document.getElementById('ovBadge');
  const rep=Object.entries(counts).filter(([,c])=>c>=3);
  badge.textContent=`${rep.length} repeated`;
  badge.className='badge '+(rep.length>5?'b-r':rep.length>0?'b-t':'b-gray');
  if(!rep.length){list.innerHTML=`<div style="text-align:center;padding:1.2rem;color:var(--ink3);font-size:.82rem"><i class="fas fa-check-circle"></i> No repeated issues yet</div>`;return;}
  list.innerHTML=rep.map(([cat,cnt])=>{
    const cls=cnt>=10?'crit':cnt>=5?'hi':'';
    return `<div class="ov-row ${cls}"><span style="font-weight:600;font-size:.88rem">${cat}</span><span class="ov-cnt">√ó${cnt}</span></div>`;
  }).join('');
}

function updatePhys(){
  const lines=v('tPhys').split('\n').map(l=>l.trim()).filter(l=>l);
  const s=document.getElementById('physSum');
  if(!lines.length){s.style.display='none';return;}
  let comp=0,shift=0,cancel=0;
  lines.forEach(l=>{const t=l.toLowerCase();
    if(t.includes('done')||t.includes('complete')||t.includes('fixed')||t.includes('solved'))comp++;
    else if(t.includes('shift')||t.includes('next day')||t.includes('pending'))shift++;
    else if(t.includes('cancel'))cancel++;
  });
  document.getElementById('physGrid').innerHTML=
    pBox(lines.length,'Total','var(--P)')+pBox(comp,'Complete','var(--G)')+pBox(shift,'Shift','var(--Y)')+pBox(cancel,'Cancel','var(--R)');
  s.style.display='block';
}
function pBox(n,l,c){return`<div class="phys-box"><div class="phys-v" style="color:${c}">${n}</div><div class="phys-l">${l}</div></div>`;}

async function genTL(){
  const date=v('tDate'),tlName=v('tName'),shift=v('tShift');
  const issues=v('tIssues').trim().split('\n').filter(l=>l.trim());
  const physLines=v('tPhys').trim().split('\n').filter(l=>l.trim());
  const persons=v('tPersons').trim()||'Shamsur + Rony';
  const proc=v('tSS').trim().split(/\r?\n/).map(l=>l.replace(/"/g,'').trim()).filter(l=>l);

  if(!shift){toast('Select a shift','err');return;}
  if(!tlName){toast('Select TL name','err');return;}

  ld('Generating TL report‚Ä¶');
  let comp=0,shiftC=0,cancel=0;
  physLines.forEach(l=>{const t=l.toLowerCase();
    if(t.includes('done')||t.includes('complete')||t.includes('fixed')||t.includes('solved'))comp++;
    else if(t.includes('shift')||t.includes('next day')||t.includes('pending'))shiftC++;
    else if(t.includes('cancel'))cancel++;
  });
  const counts=getCounts(issues);
  const remRec=issues.length,procCnt=proc.length,remSolv=remRec-procCnt;
  const df=new Date(date).toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'});
  const st=shift.includes('6:30PM')?'9:00AM to 6:30PM':shift.includes('9:00AM to 9:00AM')?'9:00AM to 9:00AM':shift;

  let r=`Report: ${df} (${st})\n=============\nRemotely Support>>\n`;
  r+=`Total Issue Rec: ${remRec}\nTotal Issue Solve: ${remSolv}\n`;
  r+=procCnt>0?`Processing: ${procCnt} ( ${proc.join(' ')} )\n`:`Processing: 0\n`;
  r+=`\t\nProcessing: Soft & Sheet Processing Responsible Person : (${persons})\n\n`;
  r+=`Physically Support >>\nTotal Physical: ${physLines.length}\nComplete: ${comp}\nShift: ${shiftC}\nCancel: ${cancel}\n\n`;
  r+=`${st}\n`;

  const disp=['Slow Issues','Solved','Billing Issues','Gaming Issue','Site Browsing Issue','No Internet','Loss','Shifting','New Line'];
  let cbk=issues.filter(i=>i.toLowerCase().includes('call back')).length;
  let any=false;
  disp.forEach(cat=>{
    const c=counts[cat]||0;if(!c)return;
    const n=cat==='Site Browsing Issue'?'site browsing issue':cat==='No Internet'?'No internet':cat;
    r+=`${n}: ${c}\n`;any=true;
  });
  if(cbk>0){r+=`call back: ${cbk}\n`;any=true;}
  if(!any&&remRec>0)r+=`Issues: ${remRec}\n`;
  r+=`Remotely Solved. Details in task.\n\n`;

  const contacts={'Safikul Islam':{email:'safikul@saltsync.com',phone:'01901041903'},'S.M Faisal':{email:'faisal@saltsync.com',phone:'01901041901'}};
  if(contacts[tlName]){const c=contacts[tlName];r+=`Reported by ${tlName}\nEmail: ${c.email}\nCall: ${c.phone}\n-Thanks.\n`;}

  document.getElementById('tOutPre').textContent=r;
  const out=document.getElementById('tOut');out.style.display='block';out.classList.add('show');

  const row={date:df,tl_name:tlName,shift,issues:remRec,solved:remSolv,processing:procCnt,
             physical_total:physLines.length,physical_complete:comp,physical_shift:shiftC,
             physical_cancel:cancel,processing_persons:persons,report_content:r,ts:Date.now()};
  try{
    if(CLOUD) await fbPush('tl_reports',row);
    else{const a=getLS('srp_tr');a.unshift({...row,id:Date.now().toString()});setLS('srp_tr',a);}
    toast('TL Report saved ‚òÅÔ∏è');
  } catch(e){ toast('Save error: '+e.message,'err'); }
  hideLD();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMPLOYEE PORTAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function initPortal(){
  await refreshEmpCache();
}

async function loadPortal(){
  const name=v('portalSel');
  if(!name){document.getElementById('portalList').innerHTML=`<div style="text-align:center;padding:3rem;color:var(--ink3)"><i class="fas fa-user-circle" style="font-size:3rem;opacity:.2;display:block;margin-bottom:.7rem"></i>Select your name above</div>`;return;}
  ld('Loading your reports‚Ä¶');
  try{
    let all=[];
    if(CLOUD){const d=await fbGet('emp_reports');if(d)all=Object.values(d);}
    else all=getLS('srp_er');
    const mine=all.filter(r=>r.name===name).sort((a,b)=>(b.ts||0)-(a.ts||0));
    hideLD();
    if(!mine.length){document.getElementById('portalList').innerHTML=`<div style="text-align:center;padding:3rem;color:var(--ink3)"><i class="fas fa-inbox" style="font-size:3rem;opacity:.2;display:block;margin-bottom:.7rem"></i>No reports found for <b>${name}</b></div>`;return;}
    document.getElementById('portalList').innerHTML=mine.map(r=>`
      <div class="p-card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:.5rem">
          <div>
            <div class="p-date"><i class="fas fa-calendar" style="color:var(--P);margin-right:.35rem"></i>${r.date} ¬∑ ${r.shift} Shift</div>
            <div style="display:flex;gap:.4rem;flex-wrap:wrap;margin:.5rem 0">
              <span class="badge b-p">üìã ${r.issues} Issues</span>
              <span class="badge b-t">‚úÖ ${r.solved} Solved</span>
              ${r.processing>0?`<span class="badge b-y">‚è≥ ${r.processing} Processing</span>`:''}
              ${r.physical_support>0?`<span class="badge b-g">üîß ${r.physical_support} Physical</span>`:''}
            </div>
            ${r.special_task?`<div style="font-size:.8rem;color:var(--Y)"><i class="fas fa-star"></i> ${r.special_task.slice(0,80)}${r.special_task.length>80?'‚Ä¶':''}</div>`:''}
          </div>
          <button class="btn btn-ghost btn-sm" onclick='openModal(${JSON.stringify(r.report_content)})'><i class="fas fa-eye"></i> View</button>
        </div>
      </div>`).join('');
  } catch(e){ hideLD(); toast('Error: '+e.message,'err'); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN PANEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadAdmin(){
  if(!IS_ADMIN){go('adminGate');return;}
  ld('Loading admin data‚Ä¶');
  try{
    if(CLOUD){
      const [er,tl,emps,settings]=await Promise.all([fbGet('emp_reports'),fbGet('tl_reports'),fbGet('employees'),fbGet('settings')]);
      allER = er ? Object.entries(er).map(([id,v])=>({...v,_id:id})) : [];
      allTL = tl ? Object.entries(tl).map(([id,v])=>({...v,_id:id})) : [];
      empCache={};
      if(emps) Object.values(emps).forEach(e=>empCache[e.name]=e.eid);
      if(settings){
        sv('notifInp',settings.notification||'');
        if(settings.adminPass) localStorage.setItem(PASS_K,settings.adminPass);
      }
    } else {
      allER=getLS('srp_er'); allTL=getLS('srp_tr'); initLocalEmps();
      sv('notifInp',localStorage.getItem(NOTIF_K)||'');
    }
    allER.sort((a,b)=>(b.ts||0)-(a.ts||0));
    allTL.sort((a,b)=>(b.ts||0)-(a.ts||0));
    hideLD();
    renderEmpTable(allER); renderTLTable(allTL); updateStats(); await loadEmpMgmt();
    document.getElementById('dbSt').textContent=CLOUD?'Connected':'Local';
    document.getElementById('dbSt').className='badge '+(CLOUD?'b-t':'b-y');
    document.getElementById('dbMode').textContent=CLOUD?'Firebase Realtime DB':'Local Browser';
    document.getElementById('dbUrl').textContent=localStorage.getItem(CFG_K)||'Local only';
    document.getElementById('dbCount').textContent=(allER.length+allTL.length)+' records';
  } catch(e){ hideLD(); toast('Load error: '+e.message,'err'); }
}

function updateStats(){
  sv2('s0',allER.length); sv2('s1',allTL.length);
  sv2('s2',allER.reduce((a,r)=>a+(r.issues||0),0)+allTL.reduce((a,r)=>a+(r.issues||0),0));
  sv2('s3',allER.reduce((a,r)=>a+(r.solved||0),0)+allTL.reduce((a,r)=>a+(r.solved||0),0));
}

// ‚îÄ‚îÄ TABLES ‚îÄ‚îÄ
function emptyRow(cols,msg){return`<tr><td colspan="${cols}" style="text-align:center;padding:2.5rem;color:var(--ink3)"><i class="fas fa-inbox" style="font-size:2rem;opacity:.3;display:block;margin-bottom:.5rem"></i>${msg}</td></tr>`;}

function renderEmpTable(data){
  const tb=document.getElementById('eTBody');
  if(!data.length){tb.innerHTML=emptyRow(8,'No employee reports yet');return;}
  tb.innerHTML=data.map(r=>`<tr>
    <td><b>${r.date||'‚Äî'}</b></td>
    <td>${r.name}<br><small style="color:var(--ink3)">${r.employee_id}</small></td>
    <td><span class="badge b-gray">${r.shift}</span></td>
    <td><span class="badge b-p">${r.issues}</span></td>
    <td><span class="badge b-t">${r.solved}</span></td>
    <td>${r.physical_support>0?`<span class="badge b-g">${r.physical_support}</span>`:'-'}</td>
    <td>${r.special_task?'<i class="fas fa-star" style="color:var(--Y)"></i>':'-'}</td>
    <td style="white-space:nowrap">
      <button class="btn btn-ghost btn-sm" style="margin-right:.35rem" onclick='openModal(${JSON.stringify(r.report_content)})'><i class="fas fa-eye"></i></button>
      <button class="btn btn-r btn-sm" onclick="delReport('emp','${r._id||r.id}')"><i class="fas fa-trash"></i></button>
    </td></tr>`).join('');
}

function renderTLTable(data){
  const tb=document.getElementById('tTBody');
  if(!data.length){tb.innerHTML=emptyRow(8,'No TL reports yet');return;}
  tb.innerHTML=data.map(r=>`<tr>
    <td><b>${r.date||'‚Äî'}</b></td>
    <td>${r.tl_name}</td>
    <td><span class="badge b-gray">${r.shift}</span></td>
    <td><span class="badge b-p">${r.issues}</span></td>
    <td><span class="badge b-t">${r.solved}</span></td>
    <td><span class="badge b-g">${r.physical_total||0}</span></td>
    <td><span class="badge b-y">${r.processing||0}</span></td>
    <td style="white-space:nowrap">
      <button class="btn btn-ghost btn-sm" style="margin-right:.35rem" onclick='openModal(${JSON.stringify(r.report_content)})'><i class="fas fa-eye"></i></button>
      <button class="btn btn-r btn-sm" onclick="delReport('tl','${r._id||r.id}')"><i class="fas fa-trash"></i></button>
    </td></tr>`).join('');
}

function filterET(){ renderEmpTable(allER.filter(r=>((r.name||'')+(r.date||'')).toLowerCase().includes(v('eSearch').toLowerCase()))); }
function filterTT(){ renderTLTable(allTL.filter(r=>((r.tl_name||'')+(r.date||'')).toLowerCase().includes(v('tSearch').toLowerCase()))); }

async function delReport(type,id){
  if(!confirm('Delete this report permanently?'))return;
  ld('Deleting‚Ä¶');
  try{
    if(CLOUD) await fbDelete((type==='emp'?'emp_reports':'tl_reports')+'/'+id);
    else{
      const key=type==='emp'?'srp_er':'srp_tr';
      setLS(key,getLS(key).filter(r=>(r._id||r.id)!==id));
    }
    if(type==='emp'){allER=allER.filter(r=>(r._id||r.id)!==id);renderEmpTable(allER);}
    else{allTL=allTL.filter(r=>(r._id||r.id)!==id);renderTLTable(allTL);}
    updateStats(); hideLD(); toast('Deleted');
  } catch(e){ hideLD(); toast(e.message,'err'); }
}

// ‚îÄ‚îÄ EMPLOYEE MANAGEMENT ‚îÄ‚îÄ
async function loadEmpMgmt(){
  const el=document.getElementById('empMgList');
  const names=Object.keys(empCache).sort();
  if(!names.length){el.innerHTML=`<div style="text-align:center;padding:2rem;color:var(--ink3)">No employees yet</div>`;return;}
  el.innerHTML=names.map(n=>`<div class="emp-row">
    <div><div class="emp-nm">${n}</div><div class="emp-id-lbl"><i class="fas fa-id-badge" style="margin-right:.3rem"></i>${empCache[n]}</div></div>
    <button class="btn btn-r btn-sm" onclick="removeEmp('${n}')"><i class="fas fa-trash"></i></button>
  </div>`).join('');
}

// ‚îÄ‚îÄ DB SETTINGS ‚îÄ‚îÄ
async function reconnect(){
  const url=v('newDbUrl').trim().replace(/\/+$/,'');
  if(!url){toast('Enter new Firebase URL','err');return;}
  localStorage.setItem(CFG_K,url);
  toast('URL updated. Reloading‚Ä¶','info');
  setTimeout(()=>location.reload(),800);
}
function clearCfg(){
  if(!confirm('Remove cloud config and return to setup?'))return;
  localStorage.removeItem(CFG_K);localStorage.removeItem(MODE_K);
  location.reload();
}

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ
function tab(btn,id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('on'));
  document.querySelectorAll('.tp').forEach(p=>p.classList.remove('on'));
  btn.classList.add('on');
  document.getElementById(id).classList.add('on');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(content){
  document.getElementById('modalPre').textContent=content;
  document.getElementById('modal').classList.add('on');
}
function closeModal(e){
  if(!e||e.target===document.getElementById('modal')||e.currentTarget.tagName==='BUTTON'){
    document.getElementById('modal').classList.remove('on');
  }
}
function cpModal(){
  navigator.clipboard.writeText(document.getElementById('modalPre').textContent)
    .then(()=>toast('Copied!'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function v(id){return(document.getElementById(id)||{}).value||'';}
function sv(id,val){const el=document.getElementById(id);if(el)el.value=val;}
function sv2(id,val){const el=document.getElementById(id);if(el)el.textContent=val;}
function getLS(k){try{return JSON.parse(localStorage.getItem(k)||'[]');}catch{return[];}}
function setLS(k,v2){localStorage.setItem(k,JSON.stringify(v2));}

function copyOut(wrId){
  const pre=document.getElementById(wrId).querySelector('pre');
  if(!pre||!pre.textContent.trim()){toast('Generate a report first','err');return;}
  navigator.clipboard.writeText(pre.textContent).then(()=>toast('Copied!'));
}

function toast(msg,type='ok'){
  const d=document.createElement('div');
  d.className=`toast ${type}`;
  const ico=type==='ok'?'fa-check-circle':type==='err'?'fa-exclamation-circle':'fa-info-circle';
  d.innerHTML=`<i class="fas ${ico}"></i><span style="flex:1">${msg}</span>`;
  document.getElementById('toasts').appendChild(d);
  setTimeout(()=>{d.style.opacity='0';d.style.transform='translateX(120px)';setTimeout(()=>d.remove(),300);},3800);
}

function ld(t='Processing‚Ä¶'){
  document.getElementById('ldTxt').textContent=t;
  document.getElementById('loader').classList.add('on');
}
function hideLD(){document.getElementById('loader').classList.remove('on');}

function setPill(cls,txt){
  const p=document.getElementById('pill');
  p.className='status-pill'+(cls?' '+cls:'');
  p.innerHTML=`<span class="status-dot${cls==='ok'?' pulse':''}"></span> ${txt}`;
}

function toggleDark(){
  const h=document.documentElement,ic=document.getElementById('thIcon');
  if(h.hasAttribute('data-dark')){h.removeAttribute('data-dark');ic.className='fas fa-moon';localStorage.setItem('srp_theme','light');}
  else{h.setAttribute('data-dark','');ic.className='fas fa-sun';localStorage.setItem('srp_theme','dark');}
}
function loadTheme(){
  if(localStorage.getItem('srp_theme')==='dark'){document.documentElement.setAttribute('data-dark','');document.getElementById('thIcon').className='fas fa-sun';}
}
</script>
</body>
</html>
